name: Build Release Assets

on:
  release:
    types: [created]

permissions:
  contents: write

jobs:
  build-assets:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build all-tools.zip
        run: |
          mkdir -p build/all/qino-claude/commands
          mkdir -p build/all/qino-claude/agents
          mkdir -p build/all/qino-claude/references

          # qino-concept
          cp -r tools/qino-concept/commands/qino build/all/qino-claude/commands/
          cp tools/qino-concept/agents/*.md build/all/qino-claude/agents/
          cp -r tools/qino-concept/references/qino-concept build/all/qino-claude/references/

          # qino-dev
          mkdir -p build/all/qino-claude/commands/qino-dev
          cp tools/qino-dev/commands/qino-dev/*.md build/all/qino-claude/commands/qino-dev/
          cp tools/qino-dev/agents/*.md build/all/qino-claude/agents/
          mkdir -p build/all/qino-claude/references/qino-dev/templates
          cp -r tools/qino-dev/references/qino-dev/* build/all/qino-claude/references/qino-dev/
          cp -r tools/qino-dev/templates/* build/all/qino-claude/references/qino-dev/templates/

          # qino-scribe
          mkdir -p build/all/qino-claude/commands/scribe
          cp tools/qino-scribe/commands/scribe/*.md build/all/qino-claude/commands/scribe/
          cp -r tools/qino-scribe/references/qino-scribe build/all/qino-claude/references/

          # qino-eval
          mkdir -p build/all/qino-claude/commands/eval
          cp tools/qino-eval/commands/eval/*.md build/all/qino-claude/commands/eval/
          cp -r tools/qino-eval/references/qino-eval build/all/qino-claude/references/

          # design-adventure
          cp tools/design-adventure/commands/*.md build/all/qino-claude/commands/
          cp tools/design-adventure/agents/*.md build/all/qino-claude/agents/
          cp -r tools/design-adventure/references/design-adventure build/all/qino-claude/references/

          # updater
          cp tools/updater/commands/*.md build/all/qino-claude/commands/
          mkdir -p build/all/qino-claude/references/updater
          cp tools/updater/migrations.md build/all/qino-claude/references/updater/

          cd build/all
          zip -r ../../all-tools.zip qino-claude
          cd ../..

      - name: Upload release assets
        uses: softprops/action-gh-release@v1
        with:
          files: all-tools.zip
